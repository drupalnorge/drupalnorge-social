language: php
php:
  - 5.6
  - 7.0

sudo: false

services:
  - mysql

before_install:
  - echo 'sendmail_path = /bin/true' >> ~/.phpenv/versions/$(phpenv version-name)/etc/conf.d/travis.ini
  - phpenv config-rm xdebug.ini
  - composer --verbose self-update
  - composer --version

install:
  - composer --verbose install
  - cd $TRAVIS_BUILD_DIR/html
  - ./../vendor/bin/drush site-install minimal --verbose --yes --db-url=mysql://root@127.0.0.1
  - ./../vendor/bin/drush en config --verbose --yes
  - ./../vendor/bin/drush cset -y system.site uuid a102b1c8-bf39-4a95-8ded-ab22c0f64196
  - ./../vendor/bin/drush cim --verbose --yes
  - ./../vendor/bin/drush runserver http://127.0.0.1:8080 &
  - sleep 3

script:
  - composer test